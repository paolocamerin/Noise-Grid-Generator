
  <head>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <link rel="stylesheet" href="https://static.figma.com/api/figma-extension-api-0.0.1.css">

    <style>
      body,
      canvas,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      
      button{
        flex: 1;
      }
      h1{
        font-size: 24px;
      }

      h2{
        text-transform: none;
        font-size: 12px;
        font-weight: bold;
        margin: 0;
        margin-top: 8px;
      }
      input[type="range"] {
        width: 100%; 
        margin-top: 5px;
        margin-bottom: 10px;

      }
      input[type="number"] {
        font:inherit;
        font-size: 1em ;
        width: 120px;
        height: 32px;
        margin-top: 5px;
        border-radius: 2px;
        border: solid 1px #fff;
        padding: 4px 4px 4px 20px;
      }

      input[type="number"]:hover{
        border: solid 1px rgb(200, 200, 200);
        cursor: default;
      }

      input[type="number"]:focus{
        outline: none;
        box-shadow: 0 0 0 1px hsl(213, 90%, 70%);
      }

      /* Chrome, Safari, Edge, Opera */
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Firefox */
      input[type=number] {
        -moz-appearance: textfield;
      }

      label {
        display: block;
        position: absolute;
        margin-top: 15px;
        margin-left: 4px;
      }

      .inputsContainer {
        position: relative;
        display: flex;
        flex-direction: row;
        justify-content: left;
        flex: 1;
        
        max-width: 100%;
        gap: 16px;
      }

      

      a {
        color: dodgerblue;
      }

      .credits {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 12px;
        font-weight: 400;
        font-size: 10px;
        text-transform: uppercase;
      }

      
      
      /* .labledContainer {
        display: flex;
        flex-direction: column;
        flex: 0.5;
        justify-content: left;
        max-width: 100px;
        margin-top: 5px;
      } */
      
      
      .flex {
        display: flex;
        padding: 4px;
        gap: 16px;
        flex: 1;
        justify-content: space-between;
      }
      .cta{
        background-color: #0D8CE9;
        color: white; 
      }
      .titleContainer{
        display: flex;
        padding: 8px;
        flex: 1;
        justify-content: center;
      }
      
      .mainContainer{
        padding: 8px;
      }
      #buttons{
        margin-top: 20px;
        padding: 8px;
      }
      #cancel:hover{
        border: solid 1px #0000009e ;
      }
      #create:hover{
        background-color: #0159B5 ;
      }

      input[type=range] {
        -webkit-appearance: none; /* Hides the slider so that custom slider can be made */
        width: 100%; /* Specific width is required for Firefox. */
        background: transparent; /* Otherwise white in Chrome */

      }

      input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
      }

      input[type=range]:focus {
        outline: none; /* Removes the blue border. You should probably do some kind of focus styling for accessibility reasons though. */
      }

      input[type=range]::-ms-track {
        width: 100%;
        cursor: pointer;

        /* Hides the slider so custom styles can be added */
        background: transparent; 
        border-color: transparent;
        color: transparent;
      }

      input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        border: 2px solid #fff;
        height: 16px;
        width: 16px;
        border-radius: 8px;
        background: #000;
        cursor: pointer;
        margin-top: -8px; /* You need to specify a margin in Chrome, but in Firefox and IE it is automatic */
        box-shadow: 0px 1px 3px #393939; /* Add cool effects to your sliders! */
      }

      input[type=range]::-moz-range-thumb {
        box-shadow: 0px 1px 3px #393939;
        border: 2px solid #fff;
        height: 16px;
        width: 16px;
        border-radius: 8px;
        background: #000;
        cursor: pointer;
      }

      input[type=range]::-ms-thumb {
        box-shadow: 0px 1px 3px #393939;
        border: 2px solid #fff;
        height: 36px;
        width: 16px;
        border-radius: 8px;
        background: #000;
        cursor: pointer;
      }


      input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 1px;
        cursor: pointer;
        background: rgba(0,0,0,.3);
        border-radius: 1px;
        border: none;
        margin-top: 8px;
      }

      /* input[type=range]:focus::-webkit-slider-runnable-track {
        background: #367ebd;
      } */

      input[type=range]::-moz-range-track {
        width: 100%;
        height: 1px;
        cursor: pointer;
        background: rgba(0,0,0,.3);
        border-radius: 1px;
        border: none;
      }

      input[type=range]::-ms-track {
        width: 100%;
        height: 1px;
        cursor: pointer;
        background: rgba(0,0,0,.3);
        border: none;
        color: transparent;
      }
      input[type=range]::-ms-fill-lower {
        background: rgba(0,0,0,.3);
        border: none;
      }
      /* input[type=range]:focus::-ms-fill-lower {
        background: #3071a9;
      } */
      input[type=range]::-ms-fill-upper {
        background: rgba(0,0,0,.3);
        border: none; 
      }
      /* input[type=range]:focus::-ms-fill-upper {
        background: #367ebd;
      } */



   </style> 
  </head>
  <body>
    
   
    
    <div id="canvasContainer"></div>
    <div class="mainContainer">  
      <h2>Circles count</h2>
      <div class="inputsContainer">
        
        <div class="labeldContainer" class="singleInput">
          <label for="x_count">X</label>
          <input id="x_count" value="20" type="number"min="2" />
        </div>
        <div class="labeldContainer">
          <label for="y_count">Y</label>
          <input id="y_count" value="20" type="number" min="2" />
        </div>
      </div>
      <h2>Grid gap</h2>
      <div class="inputsContainer">
        
        <div class="labeldContainer">
          <label for="x_gap">X</label>
          <input id="x_gap" value="10" type="number" min="0"/>
        </div>
        <div class="labeldContainer">
          <label for="y_gap">Y</label>
          <input id="y_gap" value="10" type="number" min="0"/>
        </div>
      </div>
      
      <h2>Dot size</h2>
      <div class="inputsContainer">
        <div class="labeldContainer">
          <label for="dimension">Ã˜</label>
          <input id="dimension" value="20" type="number" min="0" />
        </div>
      </div>

  
      <h2>
        Displacement offset:
        <input
          id="disp_off"
          type="range"
          value="0"
          min="-200"
          max="200"
          step="1"
        />
      </h2>
      <h2>
        Smoothness:
        <input id="factor" type="range" value="10" min="1" max="50" step="1" />
      </h2>
      
      <h2>
        Noise seed:
        <input id="noiseXOffset" type="range" value="100" min="1" max="200" step="1" />
      </h2>
   <div id="buttons" class="flex">
     <button class='cta' id="create">Create</button>
  
     <button id="cancel"  >Cancel</button>
   </div>
   <div class="credits">
    <p>
      By
      <a href="https://www.figma.com/@genoma" target="_blank">G3N0M4</a>
    </p>
    <p>
      Instagram
      <a href="https://www.instagram.com/g3n0m4/" target="_blank">@g3n0m4</a>
    </p>
    
  </div>
    </div>

    <script>
      const x_textbox = document.getElementById("x_count");
      const y_textbox = document.getElementById("y_count");
      const dimension_textbox = document.getElementById("dimension");
      const x_gap_textbox = document.getElementById("x_gap");
      const y_gap_textbox = document.getElementById("y_gap");
      const displacement_slider = document.getElementById("disp_off");
      const factor_slider = document.getElementById("factor");
      const noiseXOffsetSlider = document.getElementById("noiseXOffset");

      let dots = [];

     
      let cnv;
     
      function setup() {
        cnv = createCanvas(300, 200);

        cnv.parent("canvasContainer");

        const inputs = document.querySelectorAll("input");
        for (let i = 0; i < inputs.length; i++) {
          inputs[i].addEventListener("input", generateGrid);
        }
        generateGrid();
      }

      function draw() {
        background(245);
        
        fill(42);
        noStroke();
        const margin = 10; 
        translate(width/2,height/2);
        for (let d of dots) {
        
            let scalingFactor;

            const maxW = (d.xGap+d.dimension)*d.xCount;
            const maxH = (d.yGap+d.dimension)*d.yCount;
            const initialGridAspectRatio = maxW/maxH;
            const canvasAspectRatio = width/height;
            
            if(initialGridAspectRatio>canvasAspectRatio){
               scalingFactor = width/maxW;
            }else{
               scalingFactor = height/maxH;
            }
            const mappedXGap = d.xGap*scalingFactor;
            const mappedYGap = d.yGap*scalingFactor;
            const mappedDim = d.dimension*scalingFactor;
            const mappedX = (d.x-maxW/2)*scalingFactor+(mappedDim+mappedXGap)/2;
            
            const mappedY = (d.y-maxH/2)*scalingFactor+(mappedDim+mappedYGap)/2;
            
          
            
            ellipse(mappedX, mappedY, mappedDim, mappedDim);

         
        }

        noLoop();
      }

    
     

     
      function generateGrid() {
        dots = [];
        const x_count = parseInt(x_textbox.value, 10);
        const y_count = parseInt(y_textbox.value, 10);
        const dimension = parseInt(dimension_textbox.value, 10);
        const x_gap = parseInt(x_gap_textbox.value, 10);
        const y_gap = parseInt(y_gap_textbox.value, 10);
        const displacement = parseInt(displacement_slider.value, 10);
        const factor = parseInt(factor_slider.value, 10);
        const xOffset = parseInt(noiseXOffsetSlider.value, 10); 
        let index = 0;
        
        for (let x = 0; x < x_count; x++) {
          for (let y = 0; y < y_count; y++) {
            dots.push({
              name: `Circle ${index}`,
              x: x * (x_gap + dimension ) + displacement*cos(map(noise(x / factor+xOffset, y / factor+300),0,1,-PI,PI)),
              y: y * (y_gap + dimension ) + displacement*sin(map(noise(x / factor+xOffset, y / factor+300),0,1,-PI,PI)),
              xIndex: x,
              yIndex: y,
              xCount: x_count,
              yCount: y_count, 
              dimension: dimension,
              xGap: x_gap,
              yGap: y_gap, 
              factor: factor,
            });
            index++;
          }
        }

        redraw();
      }

      document.getElementById("create").onclick = () => {
        parent.postMessage(
          {
            pluginMessage: {
              type: "create-grid",
              dots,
            },
          },
          "*"
        );
      };

      document.getElementById("cancel").onclick = () => {
        parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
      };
    </script>
  </body>
</html>
